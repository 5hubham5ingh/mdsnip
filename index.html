<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>mdsnip - Shared Markdown Viewer</title><meta name="description" content="A minimalist markdown sharing tool with high compression."><script src="https://unpkg.com/overtype"></script><style>:root{--bg-base:#e8e9ea;--bg-gradient:radial-gradient(at 50% 50%, #fffc 0px, transparent 60%), radial-gradient(at 100% 0%, #fff6 0px, transparent 50%), radial-gradient(at 0% 100%, #fff6 0px, transparent 50%);--glass-bg:#ffffff26;--glass-border:#0000000f;--text-main:#111;--accent-color:#000;--shadow:0 8px 32px 0 #0000000a;--sidebar-width:240px}[data-theme=dark]{--bg-base:#1a1a1a;--bg-gradient:radial-gradient(at 50% 50%, #2f2e2e99 0px, transparent 60%), radial-gradient(at 0% 0%, #0000004d 0px, transparent 50%), radial-gradient(at 100% 100%, #000 0px, transparent 50%);--glass-bg:#ffffff05;--glass-border:#ffffff14;--text-main:#eee;--accent-color:#fff;--shadow:0 8px 32px 0 #00000080}*{box-sizing:border-box}body{background-color:var(--bg-base);background-image:var(--bg-gradient);min-height:100vh;color:var(--text-main);flex-direction:column;align-items:center;margin:0;padding:0;font-family:Inter,sans-serif;transition:background .6s,color .6s;display:flex;overflow-x:hidden}header{justify-content:space-between;align-items:center;width:100%;max-width:1200px;padding:24px 40px;display:flex}.logo-group{align-items:center;gap:15px;display:flex}.logo{color:var(--accent-color);letter-spacing:-.04em;font-size:1.6rem;font-weight:700}.actions{gap:12px;display:flex}main{background:var(--glass-bg);-webkit-backdrop-filter:blur(24px)saturate(180%);border:1px solid var(--glass-border);width:92%;max-width:1100px;height:calc(100vh - 180px);box-shadow:var(--shadow);border-radius:32px;margin-bottom:40px;transition:all .4s cubic-bezier(.4,0,.2,1);display:flex;position:relative;overflow:hidden}#sidebar{width:var(--sidebar-width);border-right:1px solid var(--glass-border);background:#7f7f7f08;flex-direction:column;transition:width .3s cubic-bezier(.4,0,.2,1),opacity .3s;display:flex;overflow:hidden}body.sidebar-collapsed #sidebar{opacity:0;border:none;width:0}.sidebar-content{width:var(--sidebar-width);padding:24px;overflow-y:auto}.sidebar-header{text-transform:uppercase;letter-spacing:.1em;opacity:.5;margin-bottom:16px;font-size:.7rem;font-weight:700}#toc{flex-direction:column;gap:4px;display:flex}.toc-link{color:var(--text-main);text-align:left;opacity:.6;cursor:pointer;white-space:nowrap;text-overflow:ellipsis;width:100%;font-size:14px;transition:all .2s;display:block;overflow:hidden;box-shadow:none!important;background:0 0!important;border:none!important;padding:6px 5px!important}.toc-link:hover{opacity:1;transform:translate(4px)}.toc-h1{font-weight:600}.toc-h2{padding-left:12px;font-size:13px}.toc-h3{padding-left:24px;font-size:12px}#editor-container{flex:1;height:100%;overflow:hidden}#editor{width:100%;height:100%;background:0 0!important}button{background:var(--glass-bg);color:var(--text-main);border:1px solid var(--glass-border);cursor:pointer;backdrop-filter:blur(10px);border-radius:12px;justify-content:center;align-items:center;padding:10px 16px;font-size:14px;font-weight:500;transition:all .2s;display:inline-flex}button:hover{border-color:var(--text-main);transform:translateY(-1px)}button.primary{background:var(--text-main);color:var(--bg-base);border:none}#notification{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);box-shadow:var(--shadow);color:var(--text-main);opacity:0;visibility:hidden;z-index:1000;border-radius:16px;padding:12px 24px;font-size:14px;transition:all .3s;position:fixed;bottom:40px;left:50%;transform:translate(-50%)translateY(20px)}#notification.show{opacity:1;visibility:visible;transform:translate(-50%)translateY(0)}footer{width:100%;color:var(--text-main);opacity:.4;justify-content:center;gap:24px;padding:16px 40px;font-size:11px;display:flex}kbd{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:4px;margin:0 2px;padding:2px 6px;font-size:10px}#loading-overlay{background:var(--bg-base);z-index:2000;color:var(--text-main);justify-content:center;align-items:center;font-weight:600;display:flex;position:fixed;inset:0}@media (width<=768px){#sidebar,#sidebar-toggle{display:none}footer{display:none!important}header{padding:16px 20px}main{width:95%;height:calc(100vh - 140px)}}.ot-root{height:100%!important}.overtype-input,.overtype-preview-container{background:0 0!important}.overtype-toolbar{backdrop-filter:blur(10px);border-bottom:1px solid var(--glass-border)!important;background:#7f7f7f0d!important}.overtype-toolbar-button{color:var(--text-main)!important}.overtype-toolbar-button:hover{border-color:var(--text-main)!important;background:#7f7f7f0d!important;transform:translateY(-1px)!important}[data-theme=dark] .overtype-toolbar{background:#0003!important}body[data-mode=view] .overtype-toolbar{display:none!important}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:#0000001a padding-box content-box;border:2px solid #0000;border-radius:20px}[data-theme=dark] ::-webkit-scrollbar-thumb{background:#ffffff1a}::-webkit-scrollbar-thumb:hover{background-clip:content-box;background:var(--text-main)!important}*{scrollbar-width:thin;scrollbar-color:#7f7f7f33 transparent}#theme-toggle{justify-content:center;align-items:center;min-width:44px;height:38px;padding:7px 12px;font-size:22px;line-height:1;display:inline-flex}#zen{border:0;margin-left:45%}body.zen-mode main{z-index:100;margin-top:2.5vh;width:98vw!important;max-width:none!important;height:95vh!important;margin-bottom:0!important}body.zen-mode footer{display:none!important}#modal-overlay{backdrop-filter:blur(8px);z-index:3000;opacity:0;background:#0006;justify-content:center;align-items:center;transition:opacity .3s;display:none;position:fixed;inset:0}#modal-overlay.show{opacity:1;display:flex}.modal-card{background:var(--glass-bg);-webkit-backdrop-filter:blur(24px)saturate(180%);border:1px solid var(--glass-border);width:90%;max-width:400px;box-shadow:var(--shadow);border-radius:24px;padding:32px;transition:transform .3s cubic-bezier(.4,0,.2,1);transform:scale(.9)}#modal-overlay.show .modal-card{transform:scale(1)}.modal-title{color:var(--accent-color);margin-bottom:24px;font-size:1.2rem;font-weight:700}.modal-input{border:1px solid var(--glass-border);width:100%;color:var(--text-main);background:#7f7f7f0d;border-radius:12px;outline:none;margin-bottom:24px;padding:12px 16px;font-family:inherit;font-size:14px;transition:border-color .2s}.modal-input:focus{border-color:var(--text-main)}.modal-actions{justify-content:flex-end;gap:12px;display:flex}.modal-btn{min-width:80px}</style></head><body data-theme="light" data-mode="view"><div id="loading-overlay">Initializing Engine...</div><header><div class="logo-group"><button id="sidebar-toggle" title="Toggle Sidebar">☰</button> <a href="#" class="logo" style="color:inherit;text-decoration:none">mdsnip</a></div><div class="actions"><button id="theme-toggle" title="Toggle Dark Mode">☾</button> <button id="mode-toggle" title="Toggle Edit/View Mode">Edit</button> <button id="share-btn" title="Share link">Share</button></div></header><main><aside id="sidebar"><div class="sidebar-content"><div class="sidebar-header">Outline <button id="zen" title="Toogle Zen">⛶</button></div><nav id="toc"></nav></div></aside><div id="editor-container"><div id="editor"></div></div></main><div id="modal-overlay"><div class="modal-card"><div id="modal-title" class="modal-title"></div><input type="password" id="modal-input" class="modal-input" placeholder="Password"><div class="modal-actions"><button id="modal-cancel" class="modal-btn">Cancel</button> <button id="modal-confirm" class="modal-btn primary">Confirm</button></div></div></div><div id="notification">Link copied to clipboard</div><script src="static/wasm_exec.js"></script><script type="module">const shareBtn=document.getElementById("share-btn"),themeToggle=document.getElementById("theme-toggle"),modeToggle=document.getElementById("mode-toggle"),sidebarToggle=document.getElementById("sidebar-toggle"),notification=document.getElementById("notification"),loadingOverlay=document.getElementById("loading-overlay"),tocContainer=document.getElementById("toc");let wasmLoaded=!1,overtype=null;const modalOverlay=document.getElementById("modal-overlay"),modalTitle=document.getElementById("modal-title"),modalInput=document.getElementById("modal-input"),modalCancel=document.getElementById("modal-cancel"),modalConfirm=document.getElementById("modal-confirm");function showModal({title:e,showInput:t=!0,confirmText:o="Confirm",cancelText:n="Cancel"}){return new Promise(r=>{modalTitle.textContent=e,modalInput.style.display=t?"block":"none",modalConfirm.textContent=o,modalCancel.textContent=n,modalInput.value="";const i=e=>{modalOverlay.classList.remove("show"),setTimeout(()=>{modalOverlay.style.display="none",r(e)},300)};modalConfirm.onclick=()=>i(!t||modalInput.value),modalCancel.onclick=()=>i(null),modalOverlay.style.display="flex",setTimeout(()=>modalOverlay.classList.add("show"),10),t&&setTimeout(()=>modalInput.focus(),100)})}const MONO_THEME={name:"monochrome",colors:{bgPrimary:"transparent",bgSecondary:"transparent",text:"var(--text-main)",h1:"var(--text-main)",codeBg:"rgba(127, 127, 127, 0.1)",hr:"var(--glass-border)",syntaxMarker:"rgba(127, 127, 127, 0.4)",cursor:"var(--text-main)",selection:"rgba(127, 127, 127, 0.2)"}};function setMode(e){document.body.setAttribute("data-mode",e),"view"===e?(modeToggle.innerHTML="Edit",overtype&&overtype.showPreviewMode()):(modeToggle.innerHTML="View",overtype&&overtype.showNormalEditMode()),updateSidebar()}function updateSidebar(){if(!overtype||!tocContainer)return;const e=overtype.getValue().replace(/```[\s\S]*?```/g,""),t=/^(#{1,3})\s+(.*)/gm;let o;for(tocContainer.innerHTML="";null!==(o=t.exec(e));){const e=o[1].length,t=o[2].trim(),n=document.createElement("button");n.className=`toc-link toc-h${e}`,n.textContent=t,n.onclick=()=>{const e=document.getElementById("editor"),o=e.querySelector(".overtype-preview-container")||e.querySelector(".overtype-preview")||e.querySelector("textarea")||e.querySelector('[style*="overflow-y: auto"]');if(!o)return;const n=Array.from(o.querySelectorAll("h1, h2, h3, .overtype-heading")).find(e=>e.textContent.trim().includes(t));n&&o.scrollTo({top:n.offsetTop-20,behavior:"smooth"})},tocContainer.appendChild(n)}}function initOverType(e=""){const[t]=new OverType("#editor",{value:e,placeholder:"Start writing...",theme:MONO_THEME,toolbar:!0,fontSize:"16px"});overtype=t,document.getElementById("editor").addEventListener("click",e=>{e.target.closest(".overtype-toolbar-button")&&setTimeout(()=>{const e=!!document.querySelector(".overtype-preview")||!document.querySelector(".overtype-input")?"view":"write";document.body.getAttribute("data-mode")!==e&&setMode(e)},50)}),document.getElementById("editor").addEventListener("input",updateSidebar),setMode(document.body.getAttribute("data-mode")||"view")}const go=new Go;async function handleInitialData(){let e=window.location.hash.substring(1);if(!e)return initOverType(""),void setMode("write");const t=e.startsWith(".");t&&(e=e.substring(1));const o=window.decompressMarkdown(e);if("string"==typeof o&&o.startsWith("Error:"))return void initOverType("# Error\n"+o);let n;if(t){const e=await showModal({title:"Encryption required"});if(null===e)return void initOverType("# Encrypted\nAuthentication required to view this content.");const t=window.decryptMarkdown(o,e);if("string"==typeof t&&t.startsWith("Error:"))return alert("Incorrect password or decryption failed."),void initOverType("# Error\n"+t);n=t}else n=(new TextDecoder).decode(o);initOverType(n),setMode("view")}WebAssembly.instantiateStreaming(fetch("static/main.wasm"),go.importObject).then(e=>{go.run(e.instance),wasmLoaded=!0,loadingOverlay.style.display="none",handleInitialData()}).catch(e=>{loadingOverlay.innerHTML="Error loading engine."}),shareBtn.addEventListener("click",async()=>{if(!wasmLoaded||!overtype)return;const e=overtype.getValue();if(!e.trim())return alert("Write something first!");let t=e,o="";const n=await showModal({title:"Protect this link with a password?",showInput:!1,confirmText:"Protect",cancelText:"Skip"});if(n){const n=await showModal({title:"Enter encryption password"});if(!n)return;const r=window.encryptMarkdown(e,n);if("string"==typeof r&&r.startsWith("Error:"))return alert(r);t=r,o="."}const r=window.compressMarkdown(t),i=`${window.location.origin}${window.location.pathname}#${o}${r}`;navigator.clipboard.writeText(i).then(()=>{notification.textContent=n?"Encrypted link copied!":"Link copied to clipboard",notification.classList.add("show"),setTimeout(()=>notification.classList.remove("show"),3e3)})}),sidebarToggle.addEventListener("click",()=>{document.body.classList.toggle("sidebar-collapsed")}),modeToggle.addEventListener("click",()=>{setMode("view"===document.body.getAttribute("data-mode")?"write":"view")}),themeToggle.addEventListener("click",()=>{const e="dark"===document.body.getAttribute("data-theme");document.body.setAttribute("data-theme",e?"light":"dark"),themeToggle.textContent=e?"☾":"☼"});const zenModeBtn=document.getElementById("zen"),zenModeToggle=()=>document.body.classList.toggle("zen-mode");zenModeBtn.addEventListener("click",zenModeToggle),window.addEventListener("keydown",e=>{if(e.ctrlKey){if("Space"===e.code&&(e.preventDefault(),modeToggle.click()),"Enter"===e.key&&(e.preventDefault(),shareBtn.click()),!e.shiftKey)return;const t=e.key.toLowerCase();"z"===t?(e.preventDefault(),zenModeToggle()):"l"===t&&(e.preventDefault(),themeToggle.click())}})</script></body></html>